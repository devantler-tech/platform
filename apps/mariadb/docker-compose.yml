networks:
  internal:
    external: true
  traefik:
    external: true
services:
  mariadb:
    environment:
      MARIADB_PASSWORD: ${PASSWORD?}
      MARIADB_ROOT_PASSWORD: ${ROOT_PASSWORD?}
      MARIADB_USER: ${USER?}
      MARIADB_MYSQL_LOCALHOST_USER: true
    healthcheck:
      test: mysqladmin ping -P 3306 -p=${ROOT_PASSWORD?} | grep 'mariadb is alive' || exit 1
    image: mariadb:10.9.5
    labels:
      traefik.enable: true
      traefik.tcp.routers.mariadb.entrypoints: mariadb
      traefik.tcp.routers.mariadb.rule: HostSNI(`*`)
    networks:
      - internal
      - traefik
    volumes:
      - mariadb-mysql:/var/lib/mysql
volumes:
  mariadb-mysql: null
