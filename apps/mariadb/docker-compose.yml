networks:
  internal:
    external: true
  traefik:
    external: true
services:
  mariadb:
    environment:
      MARIADB_MYSQL_LOCALHOST_USER: true
      MARIADB_PASSWORD: ${PASSWORD?}
      MARIADB_ROOT_PASSWORD: ${ROOT_PASSWORD?}
      MARIADB_USER: ${USER?}
    healthcheck:
      test: mysqladmin ping --protocol tcp -P 3306 -p${ROOT_PASSWORD?}
    image: mariadb:10.9.5
    labels:
      traefik.enable: true
      traefik.tcp.routers.mariadb.entrypoints: mariadb
      traefik.tcp.routers.mariadb.rule: HostSNI(`*`)
    networks:
      - internal
      - traefik
    volumes:
      - mariadb-mysql:/var/lib/mysql
volumes:
  mariadb-mysql: null
