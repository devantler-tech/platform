networks:
  internal:
    external: true
  public:
    external: true
services:
  contoso-university-dp:
    image: ghcr.io/devantler/data-product:main
    networks:
      - internal
      - public
    environment:
      PUBLIC_URL: https://contoso-university-dp.${DOMAIN?}
      LICENSE_NAME: MIT
      LICENSE_URL: https://opensource.org/licenses/MIT
      OWNER_NAME: ${OWNER_NAME?}
      OWNER_EMAIL: ${OWNER_EMAIL?}
      OWNER_ORGANISATION: ${OWNER_ORGANISATION?}
      OWNER_PHONE: ${OWNER_PHONE?}
      OWNER_WEBSITE: ${OWNER_WEBSITE?}
      DASHBOARD_LINKS_0_NAME: Kafka
      DASHBOARD_LINKS_0_URL: https://kafka-ui.devantler.com/
      DASHBOARD_LINKS_1_NAME: pgweb
      DASHBOARD_LINKS_1_URL: https://pgweb.devantler.com/
      DASHBOARD_LINKS_2_NAME: DataHub
      DASHBOARD_LINKS_2_URL: https://datahub.devantler.com/
      DATASTORE_TYPE: SQL
      DATASTORE_PROVIDER: PostgreSQL
      DATASTORE_CONNECTIONSTRING: Host=postgres;Port=5432;Database=contoso-university;Username=postgres;Password=${POSTGRES_PASSWORD?}
      CACHESTORE_TYPE: InMemory
      SCHEMAREGISTRY_TYPE: Kafka
      SCHEMAREGISTRY_URL: https://schema-registry.devantler.com
      SCHEMAREGISTRY_SCHEMA_SUBJECT: contoso-university-value
      SCHEMAREGISTRY_SCHEMA_VERSION: 1
      DATACATALOG_TYPE: DataHub
      DATACATALOG_URL: https://datahub.devantler.com
      DATACATALOG_ACCESSTOKEN: ${DATACATALOG_ACCESSTOKEN?}
      DATAINGESTORS_0_TYPE: Local
      DATAINGESTORS_0_FILEPATH: assets/data/contoso-university-single.json
      DATAINGESTORS_1_TYPE: Local
      DATAINGESTORS_1_FILEPATH: assets/data/contoso-university-multiple.json
      DATAINGESTORS_2_TYPE: Kafka
      DATAINGESTORS_2_GROUPID: contoso-university
      DATAINGESTORS_2_TOPIC: contoso-university
      DATAINGESTORS_2_SERVERS: kafka:9092
      FEATUREFLAGS_ENABLEDASHBOARD: true
      FEATUREFLAGS_ENABLEAPIS_0: Rest
      FEATUREFLAGS_ENABLEAPIS_1: GraphQL
      FEATUREFLAGS_ENABLECACHING: true
      FEATUREFLAGS_ENABLEDATAINGESTION: true
      FEATUREFLAGS_ENABLEDATACATALOG: true
      FEATUREFLAGS_ENABLEDATAEGESTION: false
      FEATUREFLAGS_ENABLETRACING: false
      FEATUREFLAGS_ENABLEMETRICS: false
      FEATUREFLAGS_ENABLEAUTHENTICATION: false
      FEATUREFLAGS_ENABLEAUTHORISATION: false
      FEATUREFLAGS_ENABLEWEBHOOKS: false
    labels:
      traefik.enable: true
      traefik.http.routers.contoso-university-dp.entrypoints: ${TRAEFIK_ENTRYPOINTS?}
      traefik.http.routers.contoso-university-dp.rule: Host(`contoso-university-dp.${DOMAIN?}`)
    restart: unless-stopped
