networks:
  public:
    external: true
services:
  valheim-server:
    cap_add:
      - sys_nice
    environment:
      SERVER_NAME: ${VALHEIM_SERVER_NAME?}
      SERVER_PASS: ${VALHEIM_SERVER_PASS?}
      SERVER_PUBLIC: ${IS_SERVER_PUBLIC?}
      WORLD_NAME: ${VALHEIM_WORLD_NAME?}
    image: lloesche/valheim-server:latest
    labels:
      traefik.enable: true
      traefik.tcp.routers.valheim-tcp.entrypoints: valheim-tcp
      traefik.tcp.routers.valheim-tcp.rule: HostSNI(`valheim-server.${DOMAIN?}`)
      traefik.udp.routers.valheim-udp1.entrypoints: valheim-udp1
      traefik.udp.routers.valheim-udp1.rule: HostSNI(`valheim-server.${DOMAIN?}`)
      traefik.udp.routers.valheim-udp2.entrypoints: valheim-udp2
      traefik.udp.routers.valheim-udp2.rule: HostSNI(`valheim-server.${DOMAIN?}`)
    networks:
      - public
    platform: linux/amd64
    restart: unless-stopped
    volumes:
      - valheim-config:/config
      - valheim-data:/opt/valheim
volumes:
  valheim-config: null
  valheim-data: null
