apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization
resources:
  - configmaps/oauth2-proxy-configmap.yaml
  - https://github.com/devantler/oci-artifacts//k8s/cert-manager?ref=v0.0.24
  - https://github.com/devantler/oci-artifacts//k8s/cloudflared?ref=v0.0.24
  - https://github.com/devantler/oci-artifacts//k8s/crossplane?ref=v0.0.24
  # - https://github.com/devantler/oci-artifacts//k8s/gha-runner-scale-set?ref=main
  - https://github.com/devantler/oci-artifacts//k8s/goldilocks?ref=v0.0.24
  - https://github.com/devantler/oci-artifacts//k8s/harbor?ref=v0.0.24
  - https://github.com/devantler/oci-artifacts//k8s/metrics-server?ref=v0.0.24
  - https://github.com/devantler/oci-artifacts//k8s/oauth2-proxy?ref=v0.0.24
  - https://github.com/devantler/oci-artifacts//k8s/pulumi-operator?ref=v0.0.24
  - https://github.com/devantler/oci-artifacts//k8s/traefik?ref=v0.0.24
  - ingresses/cilium-hubble-ingress.yaml
  - pvcs/pulumi-backend-pvc.yaml

patches:
  - path: patches/goldilocks-patch.yaml
    target:
      kind: HelmRelease
      name: goldilocks
      namespace: goldilocks
  - path: patches/pulumi-operator-patch.yaml
    target:
      kind: HelmRelease
      name: pulumi-operator
      namespace: pulumi-operator
  - path: patches/traefik-patch.yaml
    target:
      kind: HelmRelease
      name: traefik
      namespace: traefik
  - path: patches/vpa-enable-patch.yaml
    target:
      kind: Namespace
      name: flux-system
  - path: patches/vpa-enable-patch.yaml
    target:
      kind: Namespace
      name: kube-system
