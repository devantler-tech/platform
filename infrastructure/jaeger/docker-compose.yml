networks:
  public:
    external: true
  internal:
    external: true

services:
  collector:
    image: jaegertracing/jaeger-collector:1.44.0
    environment:
      SPAN_STORAGE_TYPE: elasticsearch
      ES_SERVER_URLS: http://elasticsearch-server-1:9200
    networks:
      - internal
    restart: unless-stopped
    healthcheck:
      test: wget -qO- http://localhost:14269 || exit 1

  query:
    image: jaegertracing/jaeger-query:1.45.0
    labels:
      traefik.enable: true
      traefik.http.routers.jaeger.entrypoints: ${TRAEFIK_ENTRYPOINTS:-https}
      traefik.http.routers.jaeger.rule: Host(`jaeger.${DOMAIN}`)
      traefik.http.services.jaeger.loadbalancer.server.port: 16686
    environment:
      SPAN_STORAGE_TYPE: elasticsearch
      ES_SERVER_URLS: http://elasticsearch-server-1:9200
      METRICS_STORAGE_TYPE: prometheus
      PROMETHEUS_SERVER_URL: http://prometheus-server-1:9090
    networks:
      - public
      - internal
    restart: unless-stopped
    healthcheck:
      test: wget -qO- http://localhost:16687 || exit 1
