services:
  server:
    image: plantuml/plantuml-server:v1.2023.8
    restart: unless-stopped
    healthcheck:
      test: curl -f localhost:8080 || exit 1
    labels:
      traefik.enable: true
      traefik.http.routers.plantuml-server.rule: Host(`plantuml.${DOMAIN?}`)
      traefik.http.routers.plantuml-server.entrypoints: ${TRAEFIK_ENTRYPOINTS:-https}
      traefik.http.routers.plantuml-server.middlewares: auth
    networks:
      - public
    volumes:
      - plantuml-server:/plantuml
      - tmp-jetty:/tmp/jetty

networks:
  public:
    external: true

volumes:
  plantuml-server:
  tmp-jetty: